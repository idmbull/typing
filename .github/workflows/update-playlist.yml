name: Update Playlist JSON

# C·∫•u h√¨nh Trigger: Ch·∫°y khi c√≥ code push l√™n nh√°nh main
# NH∆ØNG ch·ªâ ch·∫°y khi c√≥ thay ƒë·ªïi trong th∆∞ m·ª•c 'texts' ho·∫∑c file script
on:
  push:
    branches:
      - main  # Ho·∫∑c 'master' t√πy t√™n nh√°nh ch√≠nh c·ªßa b·∫°n
    paths:
      - 'texts/**'             # Khi thay ƒë·ªïi n·ªôi dung b√†i t·∫≠p
      - 'generate-playlist.js' # Khi s·ª≠a logic t·∫°o file

# C·∫•p quy·ªÅn ghi (write) ƒë·ªÉ bot c√≥ th·ªÉ commit file json ng∆∞·ª£c l·∫°i v√†o repo
permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. T·∫£i code v·ªÅ m√°y ·∫£o runner
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. C√†i ƒë·∫∑t Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 3. Ch·∫°y script t·∫°o JSON (File n√†y b·∫°n ƒë√£ t·∫°o ·ªü b∆∞·ªõc tr∆∞·ªõc)
      - name: Run generation script
        run: node generate-playlist.js

      # 4. Commit v√† Push thay ƒë·ªïi (n·∫øu c√≥)
      - name: Commit & Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ü§ñ Auto-update playlist JSON [skip ci]"
          file_pattern: 'dictation.json index.json' # Ch·ªâ commit 2 file n√†y
          branch: main
